<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Real World 802.11ac Performance Under OS X -</title><meta name=robots content="index,follow,noarchive"><meta name=description content="A good friend of mine recently bought an older house and had been contemplating running a bunch of Cat6 through the crawlspace in order to get good, high-speed connectivity through his home. Pretty stoked about what I found with 802.11ac performance on the MacBook Air, I thought I came across a much easier solution to his problem. I shared my iPerf data with him, but he responded with a totally valid request: was I seeing those transfer rates in real world file copies?"><meta name=author content="Larita Shotwell"><link rel="preload stylesheet" as=style href=https://assets.cdnweb.info/hugo/paper/css/app.css><link rel="preload stylesheet" as=style href=https://assets.cdnweb.info/hugo/paper/css/an-old-hope.min.css><script defer src=https://assets.cdnweb.info/hugo/paper/js/highlight.min.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=preload as=image href=./theme.png><link rel=icon href=./favicon.ico><link rel=apple-touch-icon href=./apple-touch-icon.png><meta name=generator content="Hugo 0.98.0"><meta property="og:title" content="Real World 802.11ac Performance Under OS X"><meta property="og:description" content="A good friend of mine recently bought an older house and had been contemplating running a bunch of Cat6 through the crawlspace in order to get good, high-speed connectivity through his home. Pretty stoked about what I found with 802.11ac performance on the MacBook Air, I thought I came across a much easier solution to"><meta property="og:type" content="article"><meta property="og:url" content="/the-2013-macbook-air-review-13inch.html"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-07-25T00:00:00+00:00"><meta property="article:modified_time" content="2024-07-25T00:00:00+00:00"><meta itemprop=name content="Real World 802.11ac Performance Under OS X"><meta itemprop=description content="A good friend of mine recently bought an older house and had been contemplating running a bunch of Cat6 through the crawlspace in order to get good, high-speed connectivity through his home. Pretty stoked about what I found with 802.11ac performance on the MacBook Air, I thought I came across a much easier solution to"><meta itemprop=datePublished content="2024-07-25T00:00:00+00:00"><meta itemprop=dateModified content="2024-07-25T00:00:00+00:00"><meta itemprop=wordCount content="922"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Real World 802.11ac Performance Under OS X"><meta name=twitter:description content="A good friend of mine recently bought an older house and had been contemplating running a bunch of Cat6 through the crawlspace in order to get good, high-speed connectivity through his home. Pretty stoked about what I found with 802.11ac performance on the MacBook Air, I thought I came across a much easier solution to"></head><body class=not-ready data-menu=true><header class=header><p class=logo><a class=site-name href=./index.html>PeakDash</a><a class=btn-dark></a></p><script>let bodyClx=document.body.classList,btnDark=document.querySelector(".btn-dark"),sysDark=window.matchMedia("(prefers-color-scheme: dark)"),darkVal=localStorage.getItem("dark"),setDark=e=>{bodyClx[e?"add":"remove"]("dark"),localStorage.setItem("dark",e?"yes":"no")};setDark(darkVal?darkVal==="yes":sysDark.matches),requestAnimationFrame(()=>bodyClx.remove("not-ready")),btnDark.addEventListener("click",()=>setDark(!bodyClx.contains("dark"))),sysDark.addEventListener("change",e=>setDark(e.matches))</script><nav class=menu><a href=./sitemap.xml>Sitemap</a></nav></header><main class=main><article class=post-single><header class=post-title><p><time>Jul 25, 2024</time>
<span>Larita Shotwell</span></p><h1>Real World 802.11ac Performance Under OS X</h1></header><section class=post-content><p>A good friend of mine recently bought an older house and had been contemplating running a bunch of Cat6 through the crawlspace in order to get good, high-speed connectivity through his home. Pretty stoked about what I found with 802.11ac performance on the MacBook Air, I thought I came across a much easier solution to his problem. I shared my iPerf data with him, but he responded with a totally valid request: was I seeing those transfer rates in real world file copies?</p><p>I have an iMac running Mountain Lion connected over Gigabit Ethernet to my network. I mounted an AFP share on the MacBook Air connected over 802.11ac and copied a movie over.</p><p>21.2MB/s or 169.6Mbps is the fastest I saw.</p><p>Hmm. I connected the iMac to the same ASUS RT-AC66U router as the MacBook Air. Still 21.2MB/s.</p><p>I disabled all other wireless in my office. Still, no difference. I switched ethernet cables, I tried different Macs, I tried copying from a PC, I even tried copying smaller files - none of these changes did anything. At most, I only saw 21.2MB/s over 802.11ac.</p><p>I double checked my iPerf data. 533Mbps. Something weird was going on.</p><p>I plugged in Apple’s Thunderbolt Gigabit Ethernet adaptor and saw 906Mbps, clearly the source and the MacBook Air were both capable of high speed transfers.</p><p>What I tried next gave me some insight into what was going on. I setup web and FTP servers on the MacBook Air and transferred files that way. I didn’t get 533Mbps, but I broke 300Mbps. For some reason, copying over AFP or SMB shares was limited to much lower performance. This was a protocol issue.</p><h2>Digging Deeper, Finding the Culprit</h2><p>A major component of TCP networking, and what guarantees reliable data transmission, is the fact that all transfers are acknowledged and retransmitted if necessary. How frequently transfers are acknowledged has big implications on performance. Acknowledge (ACK) too frequently and you’ll get terrible throughput as the sender has to stop all work and wait for however long an ACK takes to travel across the network. Acknowledge too rarely on the other hand and you run the risk of doing a lot of wasted work in sub optimal network conditions. The TCP window size is a variable that’s used to define this balance.</p><p>TCP window size defines the max amount of data that can be in flight before an acknowledgement has to be sent/received. Modern TCP implementations support dynamic scaling of the TCP window in order to optimize for higher bandwidth interfaces.</p><p>If you know the round trip latency of a network, TCP window size as well as the maximum bandwidth that can be delivered over the connection you can actually calculate maximum usable bandwidth on the network.</p><p>The ratio of the network’s bandwidth-delay product to the TCP window size gives us that max bandwidth number.</p><p>The 2-stream 802.11ac in the new MacBook Air supports link rates of up to 867Mbps. My iPerf data showed ~533Mbps of usable bandwidth in the best conditions. Round trip latency over 50 ping requests between the MBA client and an iMac wired over Gigabit Ethernet host averaged 2.8ms. The bandwidth-delay product is 533Mbps x 2.8ms or 186,550 bytes. Now let’s look at the maximum usable bandwidth as a function of TCP window size:</p><table align=center border=0 cellpadding=0 cellspacing=1 width=650><tbody readability=2><tr class=tgrey readability=4><td align=center colspan=9>Impact of TCP Window Size on 802.11ac Transfer Rates, 533Mbps Link, 2.8ms Latency</td></tr><tr class=tlblue><td width=120>Window Size</td><td align=center valign=middle width=85>Bandwidth-Delay Product</td><td align=center valign=middle width=85>TCP Window/BDP</td><td align=center valign=middle width=85>Percentage</td><td align=center valign=middle width=85>Link Bandwidth</td><td align=center valign=middle width=85>Max Realized Bandwidth</td></tr><tr><td class=tlgrey>32KB</td><td align=center valign=middle>186550B</td><td align=center valign=middle>32768/186550B</td><td align=center valign=middle>17.6%</td><td align=center valign=middle>533Mbps</td><td align=center valign=middle>93.6Mbps</td></tr><tr><td class=tlgrey>64KB</td><td align=center valign=middle>186550B</td><td align=center valign=middle>65536/186550B</td><td align=center valign=middle>31.1%</td><td align=center valign=middle>533Mbps</td><td align=center valign=middle>187.2Mbps</td></tr><tr><td class=tlgrey>128KB</td><td align=center valign=middle>186550B</td><td align=center valign=middle>131072/186550B</td><td align=center valign=middle>70.3%</td><td align=center valign=middle>533Mbps</td><td align=center valign=middle>374.5Mbps</td></tr><tr><td class=tlgrey>256KB</td><td align=center valign=middle>186550B</td><td align=center valign=middle>262144/186550B</td><td align=center valign=middle>140.5%</td><td align=center valign=middle>533Mbps</td><td align=center valign=middle>533Mbps</td></tr></tbody></table><p>The only way to get the full 533Mbps is by using a TCP window size that’s at least 256KB.</p><p>I re-ran my iPerf test and sniffed the packets that went by to confirm the TCP window size during the test. The results came back as expected. OS X properly scaled up the TCP window to 256KB, which enabled me to get the 533Mbps result:</p><p><a href=#><img alt src=https://cdn.statically.io/img/images.anandtech.com/doci/7085/Screen%20Shot%202013-06-18%20at%2012.09.39%20AM_575px.png style=margin:auto;display:block;text-align:center;max-width:100%;height:auto></a></p><p>I then monitored packets going by while copying files over an AFP share and found my culprit:</p><p><a href=#><img alt src=https://cdn.statically.io/img/images.anandtech.com/doci/7085/Screen%20Shot%202013-06-17%20at%2011.41.34%20PM_575px.png style=margin:auto;display:block;text-align:center;max-width:100%;height:auto></a></p><p>OS X didn’t scale the TCP window size beyond 64KB, which limits performance to a bit above what I could get over 5GHz 802.11n on the MacBook Air. Interestingly enough you can get better performance over HTTP or FTP, but in none of the cases would OS X scale TCP window size to 256KB - thus artificially limiting 802.11ac.</p><p>I spent a good amount of time trying to work around this issue, even manually setting TCP window size in OS X, but came up empty handed. I’m not overly familiar with the networking stack in OS X so it’s very possible that I missed something, but I’m confident in saying that there’s an issue here. At a risk of oversimplifying, it looks like the TCP window scaling algorithm features a hard limit in OS X’s WiFi networking stack optimized for 802.11n and unaware of ac’s higher bandwidth capabilities. I should also add that the current developer preview of OS X Mavericks doesn’t fix the issue, nor does using an Apple 802.11ac router.</p><p>The bad news is that in its shipping configuration, the new MacBook Air is capable of some amazing transfer rates over 802.11ac but you won’t see them when copying files between Macs or PCs. The good news is the issue seems entirely confined to software. I’ve already passed along my findings to Apple. If I had to guess, I would expect that we’ll see a software update addressing this.</p><p class=postsid style=color:rgba(255,0,0,0)>ncG1vNJzZmivp6x7orrAp5utnZOde6S7zGiqoaenZIRxhJRoq6GdXWd9cn%2BMppicmp%2BkuG6tyKtkq52mnrK4eZBsoKebmGR%2BcQ%3D%3D</p></section><nav class=post-nav><a class=prev href=./nirvanasson-of-a-gun-lyrics.html><span>←</span><span>NirvanasSon Of A Gun Lyrics</span></a>
<a class=next href=./reese-witherspoon-eva-longoria-to-lead-march-at-2018-golden-globes.html><span>Reese Witherspoon, Eva Longoria to Lead March at 2018 Golden Globes: Report</span><span>→</span></a></nav></article></main><footer class=footer><p>&copy; 2024 <a href=./></a></p><p>Powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>️</p></footer><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/floating.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/tracking_server_6.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="//analytics.cdnweb.info/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></body></html>